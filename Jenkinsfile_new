pipeline {
    agent any

    environment {
        IMAGE_NAME = 'jmeterfile'  // Your Docker image name
        TEST_REPO = 'https://github.com/Hari-svg/Jmeter_jenkins.git'  // Your GitHub repo URL
    }

    stages {
        stage('Checkout Tests') {
            steps {
                // Clone your test scripts repository with credentials
                git branch: 'main', credentialsId: "${params.hariGitId}", url: "${TEST_REPO}"
            }
        }
        
        stage('Run JMeter Tests') {
          steps{
           script {
                    // Run Docker container with volume mapping to workspace
                    bat """
                    docker run --rm ^
                        -v "%WORKSPACE%:/tests" ^
                        ${IMAGE_NAME} ^
                        /opt/apache-jmeter-5.5/bin/jmeter ^
                        -n -t /tests/New5.jmx ^
                        -l /tests/results.jtl
                    """
                }
        }
}
        stage('Archive Results') {
            steps {
                archiveArtifacts artifacts: 'results.jtl', fingerprint: true
            }
        }
    }
}
